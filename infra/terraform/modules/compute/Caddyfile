api.zivohealth.ai {
    encode zstd gzip

    @reminders path /api/v1/reminders*
    handle @reminders {
        reverse_proxy reminders:8085
    }

    reverse_proxy api:8000
}

zivohealth.ai, www.zivohealth.ai {
    encode zstd gzip

    # Route dashboard requests to dashboard service
    handle /dashboard* {
        reverse_proxy dashboard:3000
    }

    # Route dashboard static files to dashboard service
    handle /static/* {
        reverse_proxy dashboard:3000
    }

    # Route password reset requests to backend API
    handle /reset-password* {
        reverse_proxy api:8000
    }

    # Route Reminders API to reminders service
    handle /api/v1/reminders* {
        reverse_proxy reminders:8085
    }

    # Route other API requests to backend
    handle /api/* {
        reverse_proxy api:8000
    }

    # Route health checks to backend
    handle /health {
        reverse_proxy api:8000
    }

    # Proxy static website pages from S3
    handle /privacy-policy.html {
        reverse_proxy http://zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com {
            header_up Host zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com
        }
    }

    handle /terms-and-conditions.html {
        reverse_proxy http://zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com {
            header_up Host zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com
        }
    }

    # Proxy images from S3
    handle /images/* {
        reverse_proxy http://zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com {
            header_up Host zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com
        }
    }

    # Proxy everything else (including root and other HTML files) from S3
    handle {
        reverse_proxy http://zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com {
            header_up Host zivohealth-website-bucket.s3-website-us-east-1.amazonaws.com
        }
    }
}
