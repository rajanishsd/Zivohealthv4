graph TD
    %% Intelligent Data Retrieval Flow
    subgraph "ğŸ§  Intelligent Agent-Delegated Data Retrieval"
        UserQ[ğŸ‘¤ User asks: How is my blood pressure?]
        CustomerAgent[ğŸ¯ Enhanced Customer Agent]
        
        UserQ --> CustomerAgent
        CustomerAgent --> DelegateAssess[ğŸ“‹ Delegate Question Assessment to All Agents]
        
        %% Agent Assessment Phase
        DelegateAssess --> VitalsAssess[ğŸ’“ Vitals Agent Assessment]
        DelegateAssess --> PharmacyAssess[ğŸ’Š Pharmacy Agent Assessment]
        DelegateAssess --> LabAssess[ğŸ§ª Lab Agent Assessment]
        DelegateAssess --> PrescriptionAssess[ğŸ“ Prescription Agent Assessment]
        
        %% Individual Agent Assessments
        VitalsAssess --> VitalsResult[ğŸ’“ Assessment Result<br/>Relevant: YES - Score: 0.95<br/>Strategy: Recent vitals + trends]
        PharmacyAssess --> PharmacyResult[ğŸ’Š Assessment Result<br/>Relevant: NO - Score: 0.1<br/>Strategy: None]
        LabAssess --> LabResult[ğŸ§ª Assessment Result<br/>Relevant: MAYBE - Score: 0.3<br/>Strategy: Recent BP-related labs]
        PrescriptionAssess --> PrescriptionResult[ğŸ“ Assessment Result<br/>Relevant: MAYBE - Score: 0.4<br/>Strategy: BP medications]
        
        %% Intelligent Retrieval Based on Assessment
        VitalsResult -->|High Relevance| VitalsRetrieve[ğŸ’“ Retrieve: Last 90 days BP data<br/>+ trends + latest readings]
        PharmacyResult -->|Not Relevant| NoPharmacyData[ğŸ’Š Skip - Not Relevant]
        LabResult -->|Low Relevance| NoLabData[ğŸ§ª Skip - Low Relevance]
        PrescriptionResult -->|Moderate Relevance| PrescriptionRetrieve[ğŸ“ Retrieve: Current BP medications]
        
        %% Data Assembly
        VitalsRetrieve --> DataAssembly[ğŸ”„ Assemble Retrieved Data]
        PrescriptionRetrieve --> DataAssembly
        NoPharmacyData --> DataAssembly
        NoLabData --> DataAssembly
        
        %% Intelligent Response Generation
        DataAssembly --> IntelligentResponse[ğŸ§  Generate Response<br/>Focus: BP vitals + related medications<br/>Context: Agent assessments]
        IntelligentResponse --> FinalAnswer[âœ… Your latest BP is 120/80 normal<br/>Trending stable over 90 days<br/>Current BP medication: Lisinopril]
    end
    
    %% Comparison with Old Manual System
    subgraph "âŒ Old Manual System - Replaced"
        OldUserQ[ğŸ‘¤ User asks question]
        OldCustomer[ğŸ¯ Customer Agent]
        OldUserQ --> OldCustomer
        OldCustomer --> ManualClassify[ğŸ”§ Manual LLM Classification<br/>This seems like vitals + pharmacy]
        ManualClassify --> ManualRetrieve[ğŸ“Š Fixed Retrieval<br/>Last 30 days from all types]
        ManualRetrieve --> BasicResponse[ğŸ“ Basic response with all data]
    end
    
    %% Benefits
    subgraph "âœ… Benefits of Agent-Delegated Retrieval"
        Benefit1[âš¡ Faster: Only relevant data retrieved]
        Benefit2[ğŸ¯ Smarter: Domain experts decide relevance]
        Benefit3[ğŸ”§ Flexible: Each agent uses optimal strategy]
        Benefit4[ğŸ’¡ Contextual: Agent reasoning included]
        Benefit5[ğŸ“Š Scalable: Easy to add specialized logic]
    end
    
    %% Agent Intelligence Examples
    subgraph "ğŸ¯ Agent-Specific Intelligence"
        VitalsIntel[ğŸ’“ Vitals Agent<br/>â€¢ Knows BP needs trends<br/>â€¢ Retrieves 90 days for patterns<br/>â€¢ Focuses on BP measurements]
        
        PharmacyIntel[ğŸ’Š Pharmacy Agent<br/>â€¢ Knows BP question not about costs<br/>â€¢ Skips irrelevant data<br/>â€¢ Saves processing time]
        
        PrescriptionIntel[ğŸ“ Prescription Agent<br/>â€¢ Knows BP medications relevant<br/>â€¢ Retrieves current BP prescriptions<br/>â€¢ Skips unrelated medications]
    end
    
    %% Styling
    classDef userClass fill:#e1f5fe
    classDef agentClass fill:#f3e5f5
    classDef assessClass fill:#e8f5e8
    classDef retrieveClass fill:#fff3e0
    classDef oldClass fill:#ffebee
    classDef benefitClass fill:#f1f8e9
    classDef intelClass fill:#e3f2fd
    
    class UserQ,FinalAnswer userClass
    class CustomerAgent,VitalsAssess,PharmacyAssess,LabAssess,PrescriptionAssess agentClass
    class VitalsResult,PharmacyResult,LabResult,PrescriptionResult,DelegateAssess assessClass
    class VitalsRetrieve,PrescriptionRetrieve,DataAssembly,IntelligentResponse retrieveClass
    class OldUserQ,OldCustomer,ManualClassify,ManualRetrieve,BasicResponse oldClass
    class Benefit1,Benefit2,Benefit3,Benefit4,Benefit5 benefitClass
    class VitalsIntel,PharmacyIntel,PrescriptionIntel intelClass 