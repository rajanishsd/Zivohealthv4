graph TD
    %% LangGraph State Management
    StateInit[ðŸ“‹ Initialize AgentState]
    StateInit --> CheckpointLoad[ðŸ’¾ Load Agent Checkpoint]
    CheckpointLoad --> StateRoute{ðŸŽ¯ Route Based on Operation}

    StateRoute -->|extract| ExtractState[ðŸ“Š Extract Operation State]
    StateRoute -->|store| StoreState[ðŸ’¾ Store Operation State]
    StateRoute -->|retrieve| RetrieveState[ðŸ“‹ Retrieve Operation State]
    StateRoute -->|assess| AssessState[ðŸ§  Assessment Operation State]

    ExtractState --> ProcessExtract[âš¡ Execute Extraction]
    StoreState --> ProcessStore[âš¡ Execute Storage]
    RetrieveState --> ProcessRetrieve[âš¡ Execute Retrieval]
    AssessState --> ProcessAssess[âš¡ Execute Assessment]

    ProcessExtract --> UpdateExtract[ðŸ”„ Update State with Results]
    ProcessStore --> UpdateStore[ðŸ”„ Update State with Results]
    ProcessRetrieve --> UpdateRetrieve[ðŸ”„ Update State with Results]
    ProcessAssess --> UpdateAssess[ðŸ”„ Update State with Results]

    UpdateExtract --> FinalizeState[âœ… Finalize Agent State]
    UpdateStore --> FinalizeState
    UpdateRetrieve --> FinalizeState
    UpdateAssess --> FinalizeState

    FinalizeState --> CheckpointSave[ðŸ’¾ Save Agent Checkpoint]
    CheckpointSave --> StateReturn[ðŸ“¤ Return Final State]

    %% Inter-Agent Message Passing
    CustomerRequest[ðŸ‘¤ Customer Request] --> CustomerState[ðŸ“‹ Customer Agent State]
    CustomerState --> CustomerRoute{ðŸŽ¯ Customer Agent Routing}

    CustomerRoute -->|File Processing| DocOrchState[ðŸ—ï¸ Document Orchestrator State]
    CustomerRoute -->|Data Retrieval| AssessmentState[ðŸ§  Multi-Agent Assessment State]

    DocOrchState --> SpecialistState[ðŸ“Š Specialized Agent State]
    AssessmentState --> RelevantAgents[ðŸŽ¯ Relevant Agent States]

    SpecialistState --> AgentResponse1[ðŸ“¤ Specialist Agent Response]
    RelevantAgents --> AgentResponse2[ðŸ“¤ Retrieval Agent Responses]

    AgentResponse1 --> AggregateState[ðŸ”„ Aggregate Response State]
    AgentResponse2 --> AggregateState
    AggregateState --> FinalCustomerState[âœ… Final Customer State]
    FinalCustomerState --> CustomerResponse[ðŸ“± Customer Response]

    %% Memory Management
    RequestStart[ðŸ”„ Request Starts] --> CreateThread[ðŸ§µ Create Thread ID]
    CreateThread --> MemoryLookup[ðŸ” Memory Lookup]
    MemoryLookup --> AgentMemories[ðŸ’¾ Individual Agent Memories]
    AgentMemories --> ContextSharing[ðŸ”„ Context Sharing]
    ContextSharing --> UpdateMemories[ðŸ“ Update Agent Memories]
    UpdateMemories --> PersistMemory[ðŸ’¾ Persist to Storage]
    PersistMemory --> MemoryReady[âœ… Memory Ready for Next Request]

    %% Styling
    classDef stateClass fill:#e8f5e8
    classDef processClass fill:#f3e5f5
    classDef memoryClass fill:#fff3e0
    classDef messageClass fill:#e1f5fe

    class StateInit,ExtractState,StoreState,RetrieveState,AssessState,CustomerState stateClass
    class ProcessExtract,ProcessStore,ProcessRetrieve,ProcessAssess,UpdateExtract,UpdateStore processClass
    class CheckpointLoad,CheckpointSave,AgentMemories,ContextSharing,UpdateMemories,PersistMemory memoryClass
    class CustomerRequest,AgentResponse1,AgentResponse2,AggregateState,FinalCustomerState messageClass